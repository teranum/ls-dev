# -*- coding: euc-kr -*-
from xingAsync import *
from common import *
from app_key import user_id, user_pwd, cert_pwd # app_key.py 파일에 사용자 ID, 비번, 공증 비번을 저장해두고 import

async def sample(api: XingApi):
    if not await api.login(user_id, user_pwd, cert_pwd):
        return print(f"로그인 실패: {api.last_message}")

    keysymbol = '82TSLA' # 82TSLA: 테슬라, 82AAPL: 애플
    inputs = {
        "delaygb": "R",             # 지연구분 'R':실시간
        "keysymbol": keysymbol,     # KEY종목코드
        "exchcd": keysymbol[:2],    # 거래소코드(81: 뉴욕/아멕스, 82: 나스닥)
        "symbol": keysymbol[2:],    # 종목코드
        "gubun": "2",               # 2:일, 3:주, 4:월, 5:년
        "qrycnt": 100,              # 요청건수(최대-압축:2000비압축:500)
        "comp_yn": "N",             # 압축여부(Y:압축N:비압축)
        "sdate": "",                # 시작일자
        "edate": "",                # 종료일자
        "cts_date": "",             # 연속일자 (연속조회시 필요)
        "cts_info": "",             # 연속정보 (연속조회시 필요)
        "sujung": "1",              # 수정주가여부(Y:적용N:비적용)
        }

    response = await api.request("g3204", inputs)
    if not response: return print(f'요청실패: {api.last_message}')

    print(response)

if __name__ == "__main__":
    api = XingApi()
    run_loop(sample(api))

# Output:
'''
g3204: [00000] 조회완료
g3204InBlock, Fields = 12, Count = 1
+---------+-----------+--------+--------+-------+--------+---------+-------+-------+----------+----------+--------+
| delaygb | keysymbol | exchcd | symbol | gubun | qrycnt | comp_yn | sdate | edate | cts_date | cts_info | sujung |
+---------+-----------+--------+--------+-------+--------+---------+-------+-------+----------+----------+--------+
|    R    |   82TSLA  |   82   |  TSLA  |   2   |  0100  |    N    |       |       |          |          |   1    |
+---------+-----------+--------+--------+-------+--------+---------+-------+-------+----------+----------+--------+
g3204OutBlock, Fields = 21, Count = 1
+---------+-----------+--------+--------+----------+----------+-----------+---------+---------+--------+----------+-----------+------+------+-----+-------+---------+---------+--------+--------+--------+
| delaygb | keysymbol | exchcd | symbol | cts_date | cts_info | rec_count | preopen | prehigh | prelow | preclose | prevolume | open | high | low | close | uplimit | dnlimit | s_time | e_time | dshmin |
+---------+-----------+--------+--------+----------+----------+-----------+---------+---------+--------+----------+-----------+------+------+-----+-------+---------+---------+--------+--------+--------+
|    R    |   82TSLA  |   82   |  TSLA  | 20240701 |  999999  |    100    |   0.0   |   0.0   |  0.0   |   0.0    |     0     | 0.0  | 0.0  | 0.0 |  0.0  |   0.0   |   0.0   | 200000 | 170000 |        |
+---------+-----------+--------+--------+----------+----------+-----------+---------+---------+--------+----------+-----------+------+------+-----+-------+---------+---------+--------+--------+--------+
g3204OutBlock1, Fields = 12, Count = 100
+----------+---------+----------+----------+--------+-----------+-------------+---------+-----------+----------+-----------+------+
|   date   |   open  |   high   |   low    | close  |   volume  |    amount   | jongchk | prtt_rate | pricechk | ratevalue | sign |
+----------+---------+----------+----------+--------+-----------+-------------+---------+-----------+----------+-----------+------+
| 20240702 |  218.89 |  231.3   |  218.06  | 231.26 | 205047920 | 46471596695 |    0    |    0.0    |    0     |     0     |  2   |
| 20240703 |  234.56 |  248.35  |  234.25  | 246.39 | 166561471 | 40352114092 |    0    |    0.0    |    0     |     0     |  2   |
| 20240705 |  249.81 |  252.37  | 242.4601 | 251.52 | 154501152 | 38347600850 |    0    |    0.0    |    0     |     0     |  2   |
| 20240708 |  247.71 | 259.439  |  244.57  | 252.94 | 157219580 | 39730179170 |    0    |    0.0    |    0     |     0     |  2   |
| 20240709 |  251.0  |  265.61  |  250.3   | 262.33 | 160742516 | 41819782206 |    0    |    0.0    |    0     |     0     |  2   |
| 20240710 |  262.8  |  267.59  |  257.86  | 263.26 | 128519430 | 33856238509 |    0    |    0.0    |    0     |     0     |  2   |
| 20240711 |  263.3  |  271.0   |  239.65  | 241.03 | 221707273 | 56058974307 |    0    |    0.0    |    0     |     0     |  5   |
...
| 20241113 |  335.85 | 344.5999 |  322.5   | 330.24 | 125405599 | 41600476489 |    0    |    0.0    |    0     |     0     |  2   |
| 20241114 |  327.69 |  329.98  |  310.37  | 311.18 | 120726109 | 38347908905 |    0    |    0.0    |    0     |     0     |  5   |
| 20241115 |  310.57 | 324.6799 |  309.22  | 320.72 | 114440286 | 36387096917 |    0    |    0.0    |    0     |     0     |  2   |
| 20241118 |  340.73 | 348.5499 |  330.01  | 338.74 | 126547455 | 43192114868 |    0    |    0.0    |    0     |     0     |  2   |
| 20241119 |  335.76 | 347.3799 |  332.75  | 346.0  |  88852452 | 30440163077 |    0    |    0.0    |    0     |     0     |  2   |
| 20241120 |  345.0  | 346.5999 |  334.3   | 342.03 |  50690663 | 17227510001 |    0    |    0.0    |    0     |     0     |  5   |
+----------+---------+----------+----------+--------+-----------+-------------+---------+-----------+----------+-----------+------+
nRqID=21, cont_yn=True, cont_key=
+----------------------------+
|  request / elapsed times   |
+----------------------------+
| 2024-11-21 07:43:32.223795 |
|       0:00:00.005957       |
+----------------------------+
'''