# -*- coding: euc-kr -*-
from xingAsync import *
from common import *
from app_key import user_id, user_pwd, cert_pwd # app_key.py 파일에 사용자 ID, 비번, 공증 비번을 저장해두고 import

async def sample(api: XingApi):
    if not await api.login(user_id, user_pwd, cert_pwd):
        return print(f"로그인 실패: {api.last_message}")

    keysymbol = '82TSLA' # 82TSLA: 테슬라, 82AAPL: 애플
    inputs = {
        "delaygb": "R",             # 지연구분 'R':실시간
        "keysymbol": keysymbol,     # KEY종목코드
        "exchcd": keysymbol[:2],    # 거래소코드(81: 뉴욕/아멕스, 82: 나스닥)
        "symbol": keysymbol[2:],    # 종목코드
        "ncnt": 10,                 # 단위(n분)
        "qrycnt": 100,              # 요청건수(최대-압축:2000비압축:500)
        "comp_yn": "N",             # 압축여부(Y:압축N:비압축)
        "sdate": "",                # 시작일자
        "edate": "",                # 종료일자
        "cts_date": "",             # 연속일자 (연속조회시 필요)
        "cts_time": "",             # 연속시간 (연속조회시 필요)
        }

    response = await api.request("g3203", inputs)
    if not response: return print(f'요청실패: {api.last_message}')

    print(response)

if __name__ == "__main__":
    api = XingApi()
    run_loop(sample(api))

# Output:
'''
g3203: [00000] 조회완료
g3203InBlock, Fields = 11, Count = 1
+---------+-----------+--------+--------+------+--------+---------+-------+-------+----------+----------+
| delaygb | keysymbol | exchcd | symbol | ncnt | qrycnt | comp_yn | sdate | edate | cts_date | cts_time |
+---------+-----------+--------+--------+------+--------+---------+-------+-------+----------+----------+
|    R    |   82TSLA  |   82   |  TSLA  | 0010 |  0100  |    N    |       |       |          |          |
+---------+-----------+--------+--------+------+--------+---------+-------+-------+----------+----------+
g3203OutBlock, Fields = 19, Count = 1
+---------+-----------+--------+--------+----------+----------+-----------+---------+----------+--------+----------+-----------+-------+----------+-------+--------+--------+--------+----------+
| delaygb | keysymbol | exchcd | symbol | cts_date | cts_time | rec_count | preopen | prehigh  | prelow | preclose | prevolume |  open |   high   |  low  | close  | s_time | e_time | timediff |
+---------+-----------+--------+--------+----------+----------+-----------+---------+----------+--------+----------+-----------+-------+----------+-------+--------+--------+--------+----------+
|    R    |   82TSLA  |   82   |  TSLA  | 20241119 |  234000  |    100    |  335.76 | 347.3799 | 332.75 |  346.0   |  88852452 | 345.0 | 346.5999 | 334.3 | 342.03 | 200000 | 170000 |   -14    |
+---------+-----------+--------+--------+----------+----------+-----------+---------+----------+--------+----------+-----------+-------+----------+-------+--------+--------+--------+----------+
g3203OutBlock1, Fields = 8, Count = 100
+----------+---------+----------+----------+----------+----------+---------+--------+
|   date   | loctime |   open   |   high   |   low    |  close   |  exevol | amount |
+----------+---------+----------+----------+----------+----------+---------+--------+
| 20241119 |  235000 |  344.44  |  344.5   |  344.31  |  344.45  |   508   |   0    |
| 20241120 |  000000 |  344.45  |  344.58  |  344.3   |  344.55  |   440   |   0    |
| 20241120 |  001000 |  344.5   |  344.58  |  344.48  |  344.57  |   933   |   0    |
| 20241120 |  002000 |  344.53  |  344.61  |  344.48  |  344.6   |   872   |   0    |
| 20241120 |  003000 |  344.52  |  344.65  |  344.52  |  344.65  |   869   |   0    |
| 20241120 |  004000 |  344.64  |  344.75  |  344.61  |  344.7   |   1901  |   0    |
| 20241120 |  005000 |  344.7   |  344.98  |  344.6   |  344.8   |   1411  |   0    |
...
| 20241120 |  155000 |  342.1   |  342.26  |  339.9   | 341.3457 | 1032075 |   0    |
| 20241120 |  160000 | 341.3457 |  342.7   |  341.13  |  342.03  | 1757452 |   0    |
| 20241120 |  161000 |  342.03  |  342.13  | 339.8357 |  341.15  | 4280849 |   0    |
| 20241120 |  162000 |  341.3   |  342.03  |  340.73  |  340.95  |  27045  |   0    |
| 20241120 |  163000 |  340.95  |  342.03  |  339.3   |  340.77  |  89310  |   0    |
| 20241120 |  164000 | 340.605  |  342.03  |  339.12  | 340.775  |  169961 |   0    |
| 20241120 |  165000 | 340.775  |  342.0   |  340.56  | 341.914  |  41860  |   0    |
| 20241120 |  170000 |  342.0   |  342.35  |  341.5   |  342.35  |  34019  |   0    |
+----------+---------+----------+----------+----------+----------+---------+--------+
nRqID=21, cont_yn=True, cont_key=
+----------------------------+
|  request / elapsed times   |
+----------------------------+
| 2024-11-21 07:42:41.584367 |
|       0:00:00.011352       |
+----------------------------+
'''