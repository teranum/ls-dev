# -*- coding: euc-kr -*-
from xingAsync import *
from common import *
from app_key import user_id, user_pwd, cert_pwd # app_key.py 파일에 사용자 ID, 비번, 공증 비번을 저장해두고 import

async def sample(api: XingApi):
    if not await api.login(user_id, user_pwd, cert_pwd):
        return print(f"로그인 실패: {api.last_message}")
    
    inputs = {
        'shcode': '005930',     # 삼성전자
        'ncnt': '10',           # 단위(n분)(0: 30초, 1: 1분, 2: 2분, ...n: n분)
        'qrycnt': 100,          # 요청건수(최대-압축:2000비압축:500)
        'nday': '0',            # 조회영업일수(0:미사용1>=사용)
        'sdate': '',            # 시작일자
        'stime': '',            # 시작시간(현재미사용)
        'edate': '99999999',    # 종료일자
        'etime': '',            # 종료시간(현재미사용)
        'cts_date': '',         # 연속일자
        'cts_time': '',         # 연속시간
        'comp_yn': 'N',         # 압축여부(Y:압축N:비압축)
    }
    response = await api.request("t8412", inputs)
    if not response: return print(f'요청실패: {api.last_message}')

    print(response)

if __name__ == "__main__":
    api = XingApi()
    run_loop(sample(api))

# Output:
'''
t8412: [00000] 정상적으로 조회가 완료되었습니다.
t8412InBlock, Fields = 11, Count = 1
+--------+------+--------+------+-------+-------+----------+-------+----------+----------+---------+
| shcode | ncnt | qrycnt | nday | sdate | stime |  edate   | etime | cts_date | cts_time | comp_yn |
+--------+------+--------+------+-------+-------+----------+-------+----------+----------+---------+
| 005930 | 0010 |  0100  |  0   |       |       | 99999999 |       |          |          |    N    |
+--------+------+--------+------+-------+-------+----------+-------+----------+----------+---------+
t8412OutBlock, Fields = 18, Count = 1
+--------+--------+--------+-------+---------+----------+--------+--------+-------+---------+---------+--------+----------+----------+--------+--------+--------+-----------+
| shcode | jisiga | jihigh | jilow | jiclose | jivolume | disiga | dihigh | dilow | diclose | highend | lowend | cts_date | cts_time | s_time | e_time | dshmin | rec_count |
+--------+--------+--------+-------+---------+----------+--------+--------+-------+---------+---------+--------+----------+----------+--------+--------+--------+-----------+
| 005930 | 56100  | 56500  | 54800 |  55300  | 20834397 | 54900  | 55600  | 54700 |  55500  |  71800  | 38800  | 20241118 |  130000  | 090000 | 153000 |   10   |    100    |
+--------+--------+--------+-------+---------+----------+--------+--------+-------+---------+---------+--------+----------+----------+--------+--------+--------+-----------+
t8412OutBlock1, Fields = 11, Count = 100
+----------+--------+-------+-------+-------+-------+-----------+--------+---------+------+------+
|   date   |  time  |  open |  high |  low  | close | jdiff_vol | value  | jongchk | rate | sign |
+----------+--------+-------+-------+-------+-------+-----------+--------+---------+------+------+
| 20241118 | 131000 | 56600 | 56700 | 56500 | 56600 |   583062  | 33003  |    0    | 0.0  |  2   |
| 20241118 | 132000 | 56600 | 56700 | 56600 | 56700 |   220200  | 12481  |    0    | 0.0  |  2   |
| 20241118 | 133000 | 56600 | 56800 | 56600 | 56600 |   588879  | 33399  |    0    | 0.0  |  2   |
| 20241118 | 134000 | 56700 | 56700 | 56400 | 56500 |   558716  | 31598  |    0    | 0.0  |  2   |
| 20241118 | 135000 | 56500 | 56600 | 56400 | 56400 |   341694  | 19294  |    0    | 0.0  |  2   |
| 20241118 | 140000 | 56400 | 56500 | 56300 | 56300 |   572170  | 32283  |    0    | 0.0  |  2   |
| 20241118 | 141000 | 56400 | 56400 | 56200 | 56200 |   758935  | 42733  |    0    | 0.0  |  2   |
...
| 20241121 | 093000 | 55000 | 55500 | 55000 | 55400 |   815200  | 45039  |    0    | 0.0  |  2   |
| 20241121 | 094000 | 55400 | 55600 | 55300 | 55500 |   668037  | 37066  |    0    | 0.0  |  2   |
| 20241121 | 095000 | 55500 | 55500 | 55200 | 55200 |   469163  | 25939  |    0    | 0.0  |  5   |
| 20241121 | 100000 | 55300 | 55600 | 55200 | 55500 |   475250  | 26336  |    0    | 0.0  |  2   |
| 20241121 | 101000 | 55600 | 55600 | 55500 | 55500 |   12163   |  675   |    0    | 0.0  |  2   |
+----------+--------+-------+-------+-------+-------+-----------+--------+---------+------+------+
nRqID=5, cont_yn=True, cont_key=
+----------------------------+
|  request / elapsed times   |
+----------------------------+
| 2024-11-21 10:00:38.305021 |
|       0:00:00.030615       |
+----------------------------+
'''