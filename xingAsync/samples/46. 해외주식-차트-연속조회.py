# -*- coding: euc-kr -*-
from xingAsync import *
from common import *
from app_key import user_id, user_pwd, cert_pwd # app_key.py 파일에 사용자 ID, 비번, 공증 비번을 저장해두고 import

async def sample(api: XingApi):
    if not await api.login(user_id, user_pwd, cert_pwd):
        return print(f"로그인 실패: {api.last_message}")

    keysymbol = '82TSLA' # 82TSLA: 테슬라, 82AAPL: 애플
    inputs = {
        "delaygb": "R",             # 지연구분 'R':실시간
        "keysymbol": keysymbol,     # KEY종목코드
        "exchcd": keysymbol[:2],    # 거래소코드(81: 뉴욕/아멕스, 82: 나스닥)
        "symbol": keysymbol[2:],    # 종목코드
        "gubun": "2",               # 2:일, 3:주, 4:월, 5:년
        "qrycnt": 100,              # 요청건수(최대-압축:2000비압축:500)
        "comp_yn": "N",             # 압축여부(Y:압축N:비압축)
        "sdate": "",                # 시작일자
        "edate": "",                # 종료일자
        "cts_date": "",             # 연속일자 (연속조회시 필요)
        "cts_info": "",             # 연속정보 (연속조회시 필요)
        "sujung": "1",              # 수정주가여부(Y:적용N:비적용)
        }

    response = await api.request("g3204", inputs)
    if not response: return print(f'요청실패: {api.last_message}')

    all_data = response['g3204OutBlock1']

     # 연속조회
    if response.cont_yn: # 연속조회가능
        inputs['cts_date'] = response['g3204OutBlock']['cts_date']
        inputs['cts_info'] = response['g3204OutBlock']['cts_info']
        response = await api.request("g3204", inputs, True)
        if not response: return print(f'연속요청 실패: {api.last_message}')
        all_data = response['g3204OutBlock1'] + all_data

    print(all_data)

if __name__ == "__main__":
    api = XingApi()
    run_loop(sample(api))

# Output:
'''
Row Count = 200
+----------+----------+----------+----------+--------+-----------+-------------+---------+-----------+----------+-----------+------+
|   date   |   open   |   high   |   low    | close  |   volume  |    amount   | jongchk | prtt_rate | pricechk | ratevalue | sign |
+----------+----------+----------+----------+--------+-----------+-------------+---------+-----------+----------+-----------+------+
| 20240207 |  188.18  |  189.79  |  182.68  | 187.58 | 111535217 | 20876418480 |    0    |    0.0    |    0     |     0     |  2   |
| 20240208 |  189.0   | 191.6171 |  185.58  | 189.56 |  83034043 | 15716223460 |    0    |    0.0    |    0     |     0     |  2   |
| 20240209 |  190.18  |  194.12  |  189.48  | 193.57 |  84476347 | 16262650969 |    0    |    0.0    |    0     |     0     |  2   |
| 20240212 |  192.11  |  194.73  |  187.28  | 188.13 |  95498597 | 18197890235 |    0    |    0.0    |    0     |     0     |  5   |
| 20240213 |  183.99  |  187.26  | 182.1087 | 184.02 |  86759478 | 15982595858 |    0    |    0.0    |    0     |     0     |  5   |
| 20240214 |  185.3   |  188.89  |  183.35  | 188.71 |  81202987 | 15137259036 |    0    |    0.0    |    0     |     0     |  2   |
| 20240215 |  189.16  |  200.88  | 188.8595 | 200.45 | 120831762 | 23679993222 |    0    |    0.0    |    0     |     0     |  2   |
| 20240216 |  202.06  |  203.17  |  197.4   | 199.95 | 111346705 | 22311717029 |    0    |    0.0    |    0     |     0     |  5   |
| 20240220 |  196.13  |  198.6   |  189.13  | 193.76 | 104545762 | 20131003039 |    0    |    0.0    |    0     |     0     |  5   |
| 20240221 |  193.36  |  199.44  |  191.95  | 194.77 | 103844008 | 20253295607 |    0    |    0.0    |    0     |     0     |  2   |
...
| 20241106 |  284.67  |  289.59  |  275.62  | 288.53 | 165228710 | 47111343220 |    0    |    0.0    |    0     |     0     |  2   |
| 20241107 |  288.89  |  299.75  |  285.52  | 296.91 | 117309232 | 34656116543 |    0    |    0.0    |    0     |     0     |  2   |
| 20241108 |  299.14  |  328.71  |  297.66  | 321.22 | 204782763 | 64883952582 |    0    |    0.0    |    0     |     0     |  2   |
| 20241111 |  346.3   |  358.64  |  336.0   | 350.0  | 210521625 | 73003572414 |    0    |    0.0    |    0     |     0     |  2   |
| 20241112 |  342.74  |  345.84  |  323.31  | 328.49 | 155726016 | 52192486797 |    0    |    0.0    |    0     |     0     |  5   |
| 20241113 |  335.85  | 344.5999 |  322.5   | 330.24 | 125405599 | 41600476489 |    0    |    0.0    |    0     |     0     |  2   |
| 20241114 |  327.69  |  329.98  |  310.37  | 311.18 | 120726109 | 38347908905 |    0    |    0.0    |    0     |     0     |  5   |
| 20241115 |  310.57  | 324.6799 |  309.22  | 320.72 | 114440286 | 36387096917 |    0    |    0.0    |    0     |     0     |  2   |
| 20241118 |  340.73  | 348.5499 |  330.01  | 338.74 | 126547455 | 43192114868 |    0    |    0.0    |    0     |     0     |  2   |
| 20241119 |  335.76  | 347.3799 |  332.75  | 346.0  |  88852452 | 30440163077 |    0    |    0.0    |    0     |     0     |  2   |
| 20241120 |  345.0   | 346.5999 |  334.3   | 342.03 |  50690663 | 17227510001 |    0    |    0.0    |    0     |     0     |  5   |
+----------+----------+----------+----------+--------+-----------+-------------+---------+-----------+----------+-----------+------+
'''